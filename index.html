<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OPUS MACHINA // ORACLE V4</title>
    <style>
        :root {
            --amber: #ffb000;
            --amber-bright: #ffcc55;
            --amber-dim: #443000;
            --bg: #050505;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg);
            color: var(--amber);
            font-family: 'Courier New', Courier, monospace;
            height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* Scanlines */
        body::before {
            content: " "; display: block; position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%);
            z-index: 100; background-size: 100% 3px; pointer-events: none;
        }

        #ui-wrapper {
            position: relative; z-index: 10;
            display: flex; flex-direction: column;
            align-items: center; width: 100%; padding: 20px;
        }

        header {
            font-weight: bold; font-size: 1.1rem; letter-spacing: 3px;
            border-bottom: 2px solid var(--amber); padding-bottom: 8px; margin-bottom: 4vh;
        }

        .altar-grid {
            display: grid;
            grid-template-areas: ". ar ." "agua vela terra" ". fogo .";
            gap: clamp(15px, 5vw, 40px);
            align-items: center; justify-items: center;
        }

        .node {
            width: clamp(80px, 20vw, 110px); height: clamp(80px, 20vw, 110px);
            background: rgba(20, 15, 0, 0.9); border: 1.5px solid var(--amber);
            color: var(--amber); cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .node.active { background: var(--amber); color: #000; box-shadow: 0 0 20px var(--amber); }

        .symbol { width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; margin-bottom: 5px; }
        .fogo .symbol { border-bottom: 18px solid var(--amber); }
        .ar .symbol { border-bottom: 18px solid var(--amber); position: relative; }
        .ar .symbol::after { content:''; position:absolute; top:10px; left:-10px; width:20px; height:2px; background:var(--amber); }
        .agua .symbol { border-top: 18px solid var(--amber); }
        .terra .symbol { border-top: 18px solid var(--amber); position: relative; }
        .terra .symbol::after { content:''; position:absolute; top:-12px; left:-10px; width:20px; height:2px; background:var(--amber); }

        .vela-container { grid-area: vela; display: flex; flex-direction: column; align-items: center; }
        .candle-base { width: 20px; height: 45px; border: 2px solid var(--amber); position: relative; }
        .flame {
            width: 14px; height: 24px; background: var(--amber-bright);
            border-radius: 50% 50% 35% 35%; margin-bottom: 4px;
            filter: blur(2px); opacity: 0; transition: opacity 0.5s;
        }
        .active .flame { opacity: 1; animation: flicker 0.1s infinite alternate; }

        #status-log {
            margin-top: 4vh; font-size: 0.8rem; color: #fff;
            border: 1px solid var(--amber-dim); padding: 12px;
            width: 90vw; max-width: 400px; text-align: center;
            background: rgba(20, 10, 0, 0.8); min-height: 60px;
        }

        #divine-btn {
            display: none; margin-top: 20px;
            background: transparent; color: var(--amber);
            border: 1px solid var(--amber); padding: 12px 24px;
            font-family: inherit; font-weight: bold;
            cursor: pointer; letter-spacing: 2px;
            transition: 0.3s;
        }
        #divine-btn:hover { background: var(--amber); color: #000; }

        /* Modal e Loading */
        #card-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); z-index: 200;
            flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; text-align: center;
        }

        #loading-screen {
            display: none; color: var(--amber); font-size: 1rem;
        }

        .card-display {
            display: none; border: 2px solid var(--amber); padding: 30px;
            max-width: 350px; background: #0a0a0a;
            box-shadow: 0 0 30px var(--amber-dim);
            animation: glitch-in 0.3s ease;
        }

        .card-title { font-size: 1.6rem; margin: 15px 0; color: var(--amber); border-bottom: 1px solid var(--amber-dim); padding-bottom: 10px; }
        .card-desc { font-size: 0.95rem; color: #eee; line-height: 1.5; text-align: justify; }

        @keyframes flicker { 0% { transform: scale(1); } 100% { transform: scale(1.05); } }
        @keyframes glitch-in {
            0% { transform: translateX(-10px); opacity: 0; }
            50% { transform: translateX(10px); }
            100% { transform: translateX(0); opacity: 1; }
        }

        .ar { grid-area: ar; } .terra { grid-area: terra; }
        .fogo { grid-area: fogo; } .agua { grid-area: agua; }
    </style>
</head>
<body>

    <div id="ui-wrapper">
        <header>:: OPUS MACHINA ::</header>

        <div class="altar-grid">
            <button class="node ar" onclick="toggleElement(this, 'AR')">
                <div class="symbol"></div>
                <b>AR</b><small>INTELECTO</small>
            </button>
            <button class="node agua" onclick="toggleElement(this, 'AGUA')">
                <div class="symbol"></div>
                <b>ÁGUA</b><small>EMOÇÃO</small>
            </button>
            <div class="vela-container" id="candle">
                <div class="flame"></div>
                <div class="candle-base"></div>
            </div>
            <button class="node terra" onclick="toggleElement(this, 'TERRA')">
                <div class="symbol"></div>
                <b>TERRA</b><small>MATÉRIA</small>
            </button>
            <button class="node fogo" onclick="toggleElement(this, 'FOGO')">
                <div class="symbol"></div>
                <b>FOGO</b><small>ENERGIA</small>
            </button>
        </div>

        <div id="status-log">AGUARDANDO CONEXÃO ELEMENTAR...</div>
        <button id="divine-btn" onclick="startDivination()">[ SCANNER DE DESTINO ]</button>
    </div>

    <div id="card-modal">
        <div id="loading-screen">
            <p id="loading-text">CALIBRANDO FREQUÊNCIAS...</p>
            <p id="loading-chars" style="font-size: 0.8rem; opacity: 0.5;"></p>
        </div>

        <div class="card-display" id="card-result">
            <small style="letter-spacing: 3px;">ARQUÉTIPO IDENTIFICADO</small>
            <div class="card-title" id="oracle-title">...</div>
            <p class="card-desc" id="oracle-desc">...</p>
            <button onclick="closeOracle()" style="background:transparent; color:var(--amber-dim); border:none; cursor:pointer; margin-top:20px; font-family:inherit;">[ REINICIAR SISTEMA ]</button>
        </div>
    </div>

    <script>
        const activeNodes = new Set();
        const log = document.getElementById('status-log');
        const candle = document.getElementById('candle');
        const divineBtn = document.getElementById('divine-btn');
        
        // 1. Deck e Lógica de Memória
        const deckOriginal = [
            { t: "O MAGO", d: "Sinal forte de manifestação. Seus comandos estão sendo processados pela realidade. Domine suas ferramentas." },
            { t: "A TORRE", d: "ALERTA: Colapso de sistema iminente. Estruturas rígidas precisam cair para que o novo código seja escrito." },
            { t: "O EREMITA", d: "Modo Offline necessário. Busque o sinal dentro do silêncio. A resposta não está na rede externa." },
            { t: "A ESTRELA", d: "Sincronia recuperada. Há uma luz guia nos dados. Mantenha o fluxo e a esperança." },
            { t: "O LOUCO", d: "Risco calculado. Inicie o novo processo sem medo do erro 404. O salto é o próprio caminho." },
            { t: "O DIABO", d: "Loop detectado. Você está preso a padrões obsoletos ou vícios de interface. Quebre o ciclo." },
            { t: "A JUSTIÇA", d: "Equação equilibrada. Toda ação gera um log de retorno. Analise suas escolhas com lógica fria." },
            { t: "A MORTE", d: "Finalização de processo. Um ciclo encerra para que o sistema seja otimizado. Não tema o reboot." }
        ];

        let currentDeck = [...deckOriginal];

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Embaralhamento inicial
        shuffle(currentDeck);

        function toggleElement(el, name) {
            el.classList.toggle('active');
            activeNodes.has(name) ? activeNodes.delete(name) : activeNodes.add(name);

            if (activeNodes.size === 4) {
                candle.classList.add('active');
                log.innerHTML = "CONEXÃO ESTABELECIDA.<br>SEQUÊNCIA DE DIVINAÇÃO PRONTA.";
                divineBtn.style.display = "block";
            } else {
                candle.classList.remove('active');
                divineBtn.style.display = "none";
                log.innerHTML = activeNodes.size === 0 ? "AGUARDANDO CONEXÃO..." : "ELEMENTOS EM SINCRONIZAÇÃO...";
            }
        }

        function startDivination() {
            document.getElementById('card-modal').style.display = 'flex';
            document.getElementById('loading-screen').style.display = 'block';
            document.getElementById('card-result').style.display = 'none';
            
            let steps = ["ANALISANDO VIBRAÇÃO...", "BUSCANDO ARQUÉTIPO...", "SINCRONIZANDO..."];
            let i = 0;
            
            const interval = setInterval(() => {
                document.getElementById('loading-text').innerText = steps[i];
                // Efeito visual de caracteres aleatórios
                document.getElementById('loading-chars').innerText = Math.random().toString(36).substring(2, 15).toUpperCase();
                i++;
                if (i >= steps.length) {
                    clearInterval(interval);
                    showResult();
                }
            }, 700);
        }

        function showResult() {
            // Se o deck acabar, reabastece e embaralha
            if (currentDeck.length === 0) {
                currentDeck = [...deckOriginal];
                shuffle(currentDeck);
            }

            // Pega a última carta da pilha (garante que não repete até o deck acabar)
            const card = currentDeck.pop();

            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('card-result').style.display = 'block';
            document.getElementById('oracle-title').innerText = card.t;
            document.getElementById('oracle-desc').innerText = card.d;
        }

        function closeOracle() {
            document.getElementById('card-modal').style.display = 'none';
        }
    </script>
</body>
</html>
